<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSCI 1250 - Prof Haas' Public Class Resources</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        ::selection {
            background-color: #ffe600bf;
        }

        ::-moz-selection {
            background-color: #ffe600bf;
        }
            
        body {
            font-family: 'Outfit', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        
        header {
            background: linear-gradient(135deg, #fb4934 0%, #df3d2b 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            clip-path: polygon(0 0, 100% 0, 100% 85%, 0 100%);
        }
        
        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .subtitle {
            font-size: 1.1rem;
            font-weight: 300;
            opacity: 0.9;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .section {
            background: white;
            margin-bottom: 2rem;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .section-header {
            background: #fb4934;
            color: white;
            padding: 1.5rem;
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .section-header::before {
            content: '';
            width: 8px;
            height: 8px;
            background: white;
            margin-right: 1rem;
            transform: rotate(45deg);
        }
        
        .section-content {
            padding: 1.5rem;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
            font-style: italic;
        }
        
        .file-list {
            list-style: none;
        }
        
        .file-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: #f8f9fa;
            border-left: 4px solid #0b00a3;
            transition: all 0.3s ease;
        }
        
        .file-item:hover {
            background: #ecf0f1;
            border-left-color: #fb4934;
            transform: translateX(5px);
        }
        
        .file-item a {
            color: #2c3e50;
            text-decoration: none;
            font-weight: 500;
            display: block;
        }
        
        .file-path {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 0.25rem;
            font-weight: 300;
        }
        
        .error {
            background: #fee;
            color: #c00;
            padding: 1rem;
            border-radius: 4px;
            border-left: 4px solid #e74c3c;
        }
        
        footer {
            text-align: center;
            padding: 2rem;
            color: #7f8c8d;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>CSCI 1250</h1>
        <div class="subtitle">Prof Haas' Public Class Resources</div>
    </header>
    
    <div class="container">
        <div class="section">
            <div class="section-header">Labs</div>
            <div class="section-content" id="labs-content">
                <div class="loading">Loading labs...</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">Lecture Resources</div>
            <div class="section-content" id="lecture-content">
                <div class="loading">Loading lecture resources...</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">Slidesets</div>
            <div class="section-content" id="slidesets-content">
                <div class="loading">Loading slidesets...</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">Study Guides</div>
            <div class="section-content" id="study-guides-content">
                <div class="loading">Loading study guides...</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">Supplementary Materials</div>
            <div class="section-content" id="supplementary-content">
                <div class="loading">Loading supplementary materials...</div>
            </div>
        </div>
        
        <div class="section">
            <div class="section-header">Syllabus</div>
            <div class="section-content" id="syllabus-content">
                <div class="loading">Loading syllabus...</div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>CSCI 1250 Class Resources â€¢ Powered by GitHub API</p>
    </footer>
    
    <script>
        const GITHUB_API_BASE = 'https://api.github.com/repos/CSCI-1250/class_resources_public/contents';
        const GITHUB_PAGES_BASE = 'https://csci-1250.github.io/class_resources_public';
        
        // Directories to ignore
        const IGNORE_DIRS = ['_config.yml', 'submission_organizer', 'templates', 'assets', 'img'];
        
        // Mapping of sections to their directory paths
        const sections = {
            'labs-content': 'labs',
            'lecture-content': 'lecture_resources',
            'slidesets-content': 'slidesets',
            'study-guides-content': 'study_guides',
            'supplementary-content': 'supplementary_materials',
            'syllabus-content': 'syllabus_202580'
        };
        
        async function fetchDirectoryContents(path) {
            try {
                const response = await fetch(`${GITHUB_API_BASE}/${path}`);
                if (!response.ok) throw new Error('Failed to fetch');
                return await response.json();
            } catch (error) {
                console.error(`Error fetching ${path}:`, error);
                return null;
            }
        }
        
        async function getAllFiles(path, filesList = []) {
            const contents = await fetchDirectoryContents(path);
            if (!contents) return filesList;
            
            for (const item of contents) {
                // Skip ignored items
                if (IGNORE_DIRS.some(ignore => item.path.includes(ignore))) {
                    continue;
                }
                
                if (item.type === 'file') {
                    filesList.push(item);
                } else if (item.type === 'dir') {
                    await getAllFiles(item.path, filesList);
                }
            }
            
            return filesList;
        }

        function titleizePath(path) {
            const tokens = path.split('_'); // Split on underscore to get individual words
            const prepositions = ["a", "an", "the", "but", "as", "if", "and", "of", "or", "nor", "with"];
            tokens.forEach((token, i) => {
            if (!prepositions.includes(token)) {
                tokens[i] = token[0].toUpperCase() + token.slice(1);
            }
            });
            return tokens.join(" ");
        }
        
        function createFileList(files) {
            if (!files || files.length === 0) {
                return '<p style="color: #999;">No files found in this section.</p>';
            }
            
            const ul = document.createElement('ul');
            ul.className = 'file-list';
            
            files.forEach(file => {
                const li = document.createElement('li');
                li.className = 'file-item';
                
                const link = document.createElement('a');
                // Handle index.md files - remove the filename from the path for Jekyll
                if (file.name === 'index.md') {
                    let fileSplit = file.path.split('/');
                    let filename = fileSplit[fileSplit.length - 2];
                    file.name = titleizePath(filename);
                    const dirPath = file.path.substring(0, file.path.lastIndexOf('/'));
                    link.href = `${GITHUB_PAGES_BASE}/${dirPath}/`;
                } else {
                    let fileSplit = file.path.split('/');
                    let filename = fileSplit[fileSplit.length - 1];
                    file.name = titleizePath(filename);
                    link.href = `${GITHUB_PAGES_BASE}/${file.path}`;
                }
                if (file.name.endsWith('.md')) {
                    file.name = file.name.replace(/\.md$/, '');
                    let pathWithoutExt = file.path.replace(/\.md$/, '');
                    link.href = `${GITHUB_PAGES_BASE}/${pathWithoutExt}`;
                }
                else if (file.name.endsWith('.html')) {
                    file.name = file.name.replace(/\.html$/, '');
                    let pathWithoutExt = file.path.replace(/\.html$/, '');
                    link.href = `${GITHUB_PAGES_BASE}/${pathWithoutExt}`;
                }
                link.target = '_blank';
                link.textContent = file.name;
                
                const pathDiv = document.createElement('div');
                pathDiv.className = 'file-path';
                pathDiv.textContent = file.path;
                
                li.appendChild(link);
                li.appendChild(pathDiv);
                ul.appendChild(li);
            });
            
            return ul.outerHTML;
        }
        
        async function loadSection(elementId, dirPath) {
            const element = document.getElementById(elementId);
            
            try {
                const files = await getAllFiles(dirPath);
                element.innerHTML = createFileList(files);
            } catch (error) {
                element.innerHTML = '<div class="error">Error loading files. Please try again later.</div>';
                console.error(`Error loading ${dirPath}:`, error);
            }
        }
        
        // Load all sections
        async function loadAllSections() {
            const promises = Object.entries(sections).map(([elementId, dirPath]) => 
                loadSection(elementId, dirPath)
            );
            await Promise.all(promises);
        }
        
        // Start loading when page loads
        loadAllSections();
    </script>
</body>
</html>